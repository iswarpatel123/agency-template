---
interface Props {
  type: "shipping" | "billing";
}

const { type } = Astro.props;
---

<form class="address-form" data-form-type={type}>
  <div class="title-bar">
    <h2>3. Tell Us Where To Ship</h2>
  </div>
  <div class="form-field">
    <input
      type="email"
      id="email"
      name="email"
      placeholder="Email Address"
      required
      data-validation-type="email"
      class="address-input"
    />
  </div>
  <div class="name-fields">
    <div class="input-group">
      <input
        type="text"
        id={`firstName-${type}`}
        name="firstName"
        placeholder="First Name"
        data-validation-type="firstName"
        required
        class="address-input"
      />
    </div>
    <div class="input-group">
      <input
        type="text"
        id={`lastName-${type}`}
        name="lastName"
        placeholder="Last Name"
        data-validation-type="lastName"
        required
        class="address-input"
      />
    </div>
  </div>

  <label for={`${type}-country`}>Country/Region</label>
  <select id={`${type}-country`} name="country" required>
    <option value="US" selected>United States</option>
  </select>

  <div class="input-group">
    <input
      type="text"
      id={`address1-${type}`}
      name="address1"
      placeholder="Address Line 1"
      data-validation-type="address"
      required
      class="address-input"
    />
  </div>

  <input
    type="text"
    id={`address2-${type}`}
    name="address2"
    placeholder="Address Line 2 (Optional)"
    data-validation-type="address"
    class="address-input"
  />

  <div class="city-state-zip">
    <div class="input-group">
      <input
        type="text"
        id={`city-${type}`}
        name="city"
        placeholder="City"
        data-validation-type="city"
        required
        class="address-input"
      />
    </div>

    <select id={`state-${type}`} name="state" required>
      <option value="" disabled selected>State</option>
      <option value="AL">Alabama</option>
      <option value="AK">Alaska</option>
      <option value="AZ">Arizona</option>
      <option value="AR">Arkansas</option>
      <option value="CA">California</option>
      <option value="CO">Colorado</option>
      <option value="CT">Connecticut</option>
      <option value="DE">Delaware</option>
      <option value="FL">Florida</option>
      <option value="GA">Georgia</option>
      <option value="HI">Hawaii</option>
      <option value="ID">Idaho</option>
      <option value="IL">Illinois</option>
      <option value="IN">Indiana</option>
      <option value="IA">Iowa</option>
      <option value="KS">Kansas</option>
      <option value="KY">Kentucky</option>
      <option value="LA">Louisiana</option>
      <option value="ME">Maine</option>
      <option value="MD">Maryland</option>
      <option value="MA">Massachusetts</option>
      <option value="MI">Michigan</option>
      <option value="MN">Minnesota</option>
      <option value="MS">Mississippi</option>
      <option value="MO">Missouri</option>
      <option value="MT">Montana</option>
      <option value="NE">Nebraska</option>
      <option value="NV">Nevada</option>
      <option value="NH">New Hampshire</option>
      <option value="NJ">New Jersey</option>
      <option value="NM">New Mexico</option>
      <option value="NY">New York</option>
      <option value="NC">North Carolina</option>
      <option value="ND">North Dakota</option>
      <option value="OH">Ohio</option>
      <option value="OK">Oklahoma</option>
      <option value="OR">Oregon</option>
      <option value="PA">Pennsylvania</option>
      <option value="RI">Rhode Island</option>
      <option value="SC">South Carolina</option>
      <option value="SD">South Dakota</option>
      <option value="TN">Tennessee</option>
      <option value="TX">Texas</option>
      <option value="UT">Utah</option>
      <option value="VT">Vermont</option>
      <option value="VA">Virginia</option>
      <option value="WA">Washington</option>
      <option value="WV">West Virginia</option>
      <option value="WI">Wisconsin</option>
      <option value="WY">Wyoming</option>
    </select>

    <div class="input-group">
      <input
        type="text"
        id={`zip-${type}`}
        name="zipCode"
        placeholder="Zip Code"
        data-validation-type="zipCode"
        required
        class="address-input"
      />
    </div>
  </div>

  <div class="input-group">
    <input
      type="tel"
      id={`phone-${type}`}
      name="phone"
      placeholder="Phone Number"
      data-validation-type="phoneNumber"
      required
      class="address-input"
    />

    <div class="mb-4 mt-6">
      <button id="showPaymentBtn" class="cta-button">
        Continue to Payment <span class="arrow">â†’</span>
      </button>
    </div>
  </div>

  <style>
    @import "/style/AddressForm.css";

    .address-form {
      overflow: hidden;
      border-radius: 0.5rem;
      padding: 0;
      border: none;
    }

    .title-bar {
      background: #004236;
      color: white;
      padding: 1rem 1.5rem;
      margin-top: 0;
      margin-left: 0;
      margin-right: 0;
      width: 100%;
      box-sizing: border-box;
    }

    .title-bar h2 {
      margin: 0;
      font-size: 1rem;
      font-weight: 600;
    }

    @media (max-width: 768px) {
      .title-bar {
        padding: 1rem;
      }
    }
  </style>

  <script>
    import { validateField } from "../../../utils/form/formUtils";

    document.addEventListener("DOMContentLoaded", () => {
      // Form validation logic
      const form = document.querySelector(".address-form");
      const inputs = form?.querySelectorAll("input[data-validation-type]");

      if (inputs) {
        inputs.forEach((input) => {
          if (!(input instanceof HTMLInputElement)) return;

          input.addEventListener("blur", () => {
            if (input.value.trim()) {
              validateField(input, true);
            }
          });

          input.addEventListener("input", () => {
            input.setCustomValidity("");
          });
        });
      }

      // Payment button logic
      const showPaymentBtn = document.getElementById("showPaymentBtn");
      const paymentFormSection = document.getElementById("paymentFormSection");

      if (showPaymentBtn && paymentFormSection) {
        showPaymentBtn.addEventListener("click", (e) => {
          e.preventDefault();

          // Validate all fields before proceeding
          const inputs = form?.querySelectorAll("input[data-validation-type]");
          let allValid = true;

          if (inputs) {
            inputs.forEach((input) => {
              if (!validateField(input as HTMLInputElement, true)) {
                allValid = false;
              }
            });
          }

          if (allValid) {
            paymentFormSection.classList.remove("hidden");
            paymentFormSection.scrollIntoView({ behavior: "smooth" });
          }
        });
      }
    });
  </script>
</form>
