---
interface Props {
  type: "shipping" | "billing";
}

const { type } = Astro.props;
---

<form class="address-form" data-form-type={type}>
  <h1 class="shipping-title bold-text">Shipping address</h1>
  <div class="form-field">
    <input
      type="email"
      id="email"
      name="email"
      placeholder="Email Address"
      required
      data-validation-type="email"
      class="address-input"
    />
  </div>
  <div class="name-fields">
    <div class="input-group">
      <input
        type="text"
        id={`firstName-${type}`}
        name="firstName"
        placeholder="First Name"
        data-validation-type="firstName"
        required
        class="address-input"
      />
    </div>
    <div class="input-group">
      <input
        type="text"
        id={`lastName-${type}`}
        name="lastName"
        placeholder="Last Name"
        data-validation-type="lastName"
        required
        class="address-input"
      />
    </div>
  </div>

  <label for={`${type}-country`}>Country/Region</label>
  <select id={`${type}-country`} name="country" required>
    <option value="US" selected>United States</option>
  </select>

  <div class="input-group">
    <input
      type="text"
      id={`address1-${type}`}
      name="address1"
      placeholder="Address Line 1"
      data-validation-type="address"
      required
      class="address-input"
    />
  </div>

  <input
    type="text"
    id={`address2-${type}`}
    name="address2"
    placeholder="Address Line 2 (Optional)"
    data-validation-type="address"
    class="address-input"
  />

  <div class="city-state-zip">
    <div class="input-group">
      <input
        type="text"
        id={`city-${type}`}
        name="city"
        placeholder="City"
        data-validation-type="city"
        required
        class="address-input"
      />
    </div>

    <select id={`state-${type}`} name="state" required>
      <option value="" disabled selected>State</option>
      <option value="AL">Alabama</option>
      <option value="AK">Alaska</option>
      <option value="AZ">Arizona</option>
      <option value="AR">Arkansas</option>
      <option value="CA">California</option>
      <option value="CO">Colorado</option>
      <option value="CT">Connecticut</option>
      <option value="DE">Delaware</option>
      <option value="FL">Florida</option>
      <option value="GA">Georgia</option>
      <option value="HI">Hawaii</option>
      <option value="ID">Idaho</option>
      <option value="IL">Illinois</option>
      <option value="IN">Indiana</option>
      <option value="IA">Iowa</option>
      <option value="KS">Kansas</option>
      <option value="KY">Kentucky</option>
      <option value="LA">Louisiana</option>
      <option value="ME">Maine</option>
      <option value="MD">Maryland</option>
      <option value="MA">Massachusetts</option>
      <option value="MI">Michigan</option>
      <option value="MN">Minnesota</option>
      <option value="MS">Mississippi</option>
      <option value="MO">Missouri</option>
      <option value="MT">Montana</option>
      <option value="NE">Nebraska</option>
      <option value="NV">Nevada</option>
      <option value="NH">New Hampshire</option>
      <option value="NJ">New Jersey</option>
      <option value="NM">New Mexico</option>
      <option value="NY">New York</option>
      <option value="NC">North Carolina</option>
      <option value="ND">North Dakota</option>
      <option value="OH">Ohio</option>
      <option value="OK">Oklahoma</option>
      <option value="OR">Oregon</option>
      <option value="PA">Pennsylvania</option>
      <option value="RI">Rhode Island</option>
      <option value="SC">South Carolina</option>
      <option value="SD">South Dakota</option>
      <option value="TN">Tennessee</option>
      <option value="TX">Texas</option>
      <option value="UT">Utah</option>
      <option value="VT">Vermont</option>
      <option value="VA">Virginia</option>
      <option value="WA">Washington</option>
      <option value="WV">West Virginia</option>
      <option value="WI">Wisconsin</option>
      <option value="WY">Wyoming</option>
    </select>

    <div class="input-group">
      <input
        type="text"
        id={`zip-${type}`}
        name="zipCode"
        placeholder="Zip Code"
        data-validation-type="zipCode"
        required
        class="address-input"
      />
    </div>
  </div>

  <div class="input-group">
    <input
      type="tel"
      id={`phone-${type}`}
      placeholder="Phone Number"
      data-validation-type="phoneNumber"
      required
      class="address-input"
    />

    <div class="px-4 mb-4 mt-6">
      <button id="showPaymentBtn" class="cta-button">
        Continue to Payment <span class="arrow">â†’</span>
      </button>
    </div>
  </div>

  <style>
    .input-group {
      display: flex;
      flex-direction: column;
      gap: 0.25rem;
      width: 100%;
    }

    .city-state-zip {
      display: flex;
      gap: 0.5rem;
    }

    .city-state-zip input {
      width: 100%;
    }

    .address-form {
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }

    .name-fields {
      display: flex;
      gap: 1rem;
    }

    input,
    select {
      padding: 0.75rem;
      border: 1px solid #333;
      border-radius: 4px;
      background: #f9f9f9;
      color: #000;
      font-weight: 600;
      width: 100%;
    }

    .address-input::placeholder {
      color: #777;
      font-weight: 600;
    }

    /* Remove custom validation styling to allow native validation UI */
    input:invalid:not(:placeholder-shown),
    input[aria-invalid="true"] {
      border-color: #dc2626;
      background-color: #fef2f2;
    }

    input:valid:not(:placeholder-shown) {
      border-color: #10b981;
    }

    /* Show validation messages */
    input:invalid:not(:placeholder-shown) + .validation-message {
      display: block;
      color: #dc2626;
      font-size: 0.875rem;
      margin-top: 0.25rem;
    }

    input:valid:not(:placeholder-shown),
    input[aria-invalid="true"] {
      border-color: inherit;
    }

    input:invalid {
      box-shadow: none;
    }

    label {
      color: #000;
    }

    @media (max-width: 600px) {
      .name-fields {
        flex-direction: column;
        gap: 0.5rem;
      }
    }

    .cta-button {
      width: 100%;
      height: 48px;
      border-radius: 0.5rem;
      background: #fbbf24;
      color: #000;
      border: none;
      padding: 1rem 1.5rem;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
      transition: background-color 0.2s;
      box-shadow:
        0 4px 6px -1px rgba(0, 0, 0, 0.1),
        0 2px 4px -1px rgba(0, 0, 0, 0.06);
    }

    .cta-button:hover {
      background: #f59e0b;
    }

    .arrow {
      font-size: 1.25rem;
    }
  </style>

  <script>
    import { validateField } from "../../../utils/form/formUtils";

    document.addEventListener("DOMContentLoaded", () => {
      // Form validation logic
      const form = document.querySelector(".address-form");
      const inputs = form?.querySelectorAll("input[data-validation-type]");

      if (inputs) {
        inputs.forEach((input) => {
          if (!(input instanceof HTMLInputElement)) return;

          input.addEventListener("blur", () => {
            if (input.value.trim()) {
              validateField(input, true);
            }
          });

          input.addEventListener("input", () => {
            input.setCustomValidity("");
          });
        });
      }

      // Payment button logic
      const showPaymentBtn = document.getElementById("showPaymentBtn");
      const paymentFormSection = document.getElementById("paymentFormSection");

      if (showPaymentBtn && paymentFormSection) {
        showPaymentBtn.addEventListener("click", (e) => {
          e.preventDefault();

          // Validate all fields before proceeding
          const inputs = form?.querySelectorAll("input[data-validation-type]");
          let allValid = true;

          if (inputs) {
            inputs.forEach((input) => {
              if (!validateField(input as HTMLInputElement, true)) {
                allValid = false;
              }
            });
          }

          if (allValid) {
            paymentFormSection.classList.remove("hidden");
            paymentFormSection.scrollIntoView({ behavior: "smooth" });
          }
        });
      }
    });
  </script>
</form>
